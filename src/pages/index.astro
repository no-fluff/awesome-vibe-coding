---
import Layout from '../layouts/Layout.astro';
import { loadData } from '../lib/data-loader.js';

const { data, categories } = loadData();

const sections = [
  {
    id: 'agents',
    title: 'Agents',
    icon: 'agents.png',
    description: null,
    data: data.agents || []
  },
  {
    id: 'apps',
    title: 'Vibe-coding apps',
    icon: 'apps.png',
    description: 'Soup-to-nuts apps for vibing.',
    data: data.apps || []
  },
  {
    id: 'interfaces',
    title: 'Agent interfaces',
    icon: 'interfaces.png',
    description: 'Use your AI agent outside the terminal.',
    data: data.interfaces || []
  },
  {
    id: 'tools',
    title: 'Tools and MCP servers',
    icon: 'tools.png',
    description: 'Everything you can plug into a coding agent.',
    data: data.tools || []
  },
  {
    id: 'workflows',
    title: 'Vibe-coding workflows',
    icon: 'workflows.png',
    description: 'Agent rules and processes to help you ship higher-quality code, faster.',
    data: data.workflows || []
  },
  {
    id: 'hosted-agents',
    title: 'Cloud-only agents',
    icon: 'hosted-agents.png',
    description: 'These closed-source agents are hosted for you.',
    data: data['hosted-agents'] || []
  }
];

function renderItem(item) {
  const hotEmoji = item.hot ? 'ðŸ”¥ ' : '';
  const hasWebsite = !!item.website;
  const hasRepo = !!item.repo;
  
  // Use the website URL for the name link, otherwise use the repo URL
  const nameUrl = item.website || item.repo;
  
  // GitHub icon SVG
  const githubIcon = '<img src="https://raw.githubusercontent.com/no-fluff/awesome-vibe-coding/main/src/images/github.svg" width="16" height="16" alt="GitHub" align="absmiddle" />';
  
  return `
    <details>
      <summary><strong>${hotEmoji}${nameUrl ? `<a href="${nameUrl}">${item.name}</a>` : item.name}${hasRepo && hasWebsite ? ` <a href="${item.repo}">${githubIcon}</a>` : ''}${hasRepo && !hasWebsite ? ` <a href="${item.repo}">${githubIcon}</a>` : ''}</strong> ${item.summary}</summary>
      
      <blockquote>${item.detail || item.summary}</blockquote>
    </details>
  `;
}

function renderCategories(sectionId) {
  const sectionCategories = categories[sectionId];
  if (!sectionCategories || !Array.isArray(sectionCategories)) return '';
  
  // Find which categories are actually used
  const usedCategories = new Set();
  if (data[sectionId] && Array.isArray(data[sectionId])) {
    data[sectionId].forEach((item) => {
      if (item.category && sectionCategories.includes(item.category)) {
        usedCategories.add(item.category);
      }
    });
  }
  
  // Generate category links for used categories only
  const categoryLinks = sectionCategories
    .filter(cat => usedCategories.has(cat))
    .map(cat => `<li><a href="#${cat.toLowerCase().replace(/\s+/g, '-')}">${cat}</a></li>`)
    .join('\n    ');
  
  return categoryLinks ? `\n    <ul>\n    ${categoryLinks}\n    </ul>` : '';
}

function renderSection(section) {
  if (!section.data || section.data.length === 0) return '';
  
  // For tools section, group by categories
  if (section.id === 'tools') {
    const categoryGroups = {};
    section.data.forEach(item => {
      const cat = item.category || 'Uncategorized';
      if (!categoryGroups[cat]) {
        categoryGroups[cat] = [];
      }
      categoryGroups[cat].push(item);
    });
    
    let html = '';
    Object.keys(categoryGroups).sort().forEach(category => {
      const anchorId = category.toLowerCase().replace(/\s+/g, '-');
      html += `<h3 id="${anchorId}">â€¢ ${category}</h3>\n\n`;
      categoryGroups[category].forEach(item => {
        html += renderItem(item) + '\n\n';
      });
    });
    
    return html;
  }
  
  // For other sections, just render items directly
  let html = '';
  section.data.forEach(item => {
    html += renderItem(item) + '\n\n';
  });
  
  return html;
}
---

<Layout title="Awesome Vibe Coding">
  <article>
    <h1>Awesome Vibe Coding</h1>
    
    <p style="display: flex; align-items: center; gap: 0.5rem; font-size: 1.1rem;">
      Don't miss new vibe-coding tools: 
      <a href="https://github.com/no-fluff/awesome-vibe-coding" 
         style="display: inline-flex; align-items: center; gap: 0.25rem; padding: 0.25rem 0.75rem; background-color: #1f883d; color: white; text-decoration: none; border-radius: 6px; font-weight: 500; font-size: 0.875rem;"
         onmouseover="this.style.backgroundColor='#1a7f37'"
         onmouseout="this.style.backgroundColor='#1f883d'">
        <svg height="16" width="16" viewBox="0 0 16 16" style="fill: currentColor;">
          <path d="M8 .25a.75.75 0 0 1 .673.418l1.882 3.815 4.21.612a.75.75 0 0 1 .416 1.279l-3.046 2.97.719 4.192a.751.751 0 0 1-1.088.791L8 12.347l-3.766 1.98a.75.75 0 0 1-1.088-.79l.72-4.194L.818 6.374a.75.75 0 0 1 .416-1.28l4.21-.611L7.327.668A.75.75 0 0 1 8 .25Zm0 2.445L6.615 5.5a.75.75 0 0 1-.564.41l-3.097.45 2.24 2.184a.75.75 0 0 1 .216.664l-.528 3.084 2.769-1.456a.75.75 0 0 1 .698 0l2.77 1.456-.53-3.084a.75.75 0 0 1 .216-.664l2.24-2.183-3.096-.45a.75.75 0 0 1-.564-.41L8 2.694Z"></path>
        </svg>
        Star
      </a>
    </p>
    
    <ul>
      <li>
        <p><a href="#agents"><strong>Agents</strong></a></p>{renderCategories('agents') && <Fragment set:html={renderCategories('agents')} />}
      </li>
      <li>
        <p><a href="#vibe-coding-apps"><strong>Vibe-coding apps</strong></a></p>{renderCategories('apps') && <Fragment set:html={renderCategories('apps')} />}
      </li>
      <li>
        <p><a href="#agent-interfaces"><strong>Agent interfaces</strong></a></p>{renderCategories('interfaces') && <Fragment set:html={renderCategories('interfaces')} />}
      </li>
      <li>
        <p><a href="#tools-and-mcp-servers"><strong>Tools and MCP servers</strong></a></p>{renderCategories('tools') && <Fragment set:html={renderCategories('tools')} />}
      </li>
      <li>
        <p><a href="#cloud-only-agents"><strong>Cloud-only agents</strong></a></p>{renderCategories('hosted-agents') && <Fragment set:html={renderCategories('hosted-agents')} />}
      </li>
      <li>
        <p><a href="#contributing"><strong>Contributing</strong></a></p>
      </li>
    </ul>

    <br />

    {sections.map(section => (
      <>
        <h2 id={section.id === 'hosted-agents' ? 'cloud-only-agents' : section.id === 'apps' ? 'vibe-coding-apps' : section.id === 'interfaces' ? 'agent-interfaces' : section.id === 'tools' ? 'tools-and-mcp-servers' : section.id === 'workflows' ? 'vibe-coding-workflows' : section.id}>
          <img 
            src={`https://raw.githubusercontent.com/no-fluff/awesome-vibe-coding/main/src/images/${section.icon}`} 
            width="36" 
            height="36" 
            alt={section.title} 
            align="absmiddle" 
          />&nbsp; {section.title}
        </h2>
        
        {section.description && (
          <p><em>{section.description}</em></p>
        )}
        
        <Fragment set:html={renderSection(section)} />
        
        <br />
      </>
    ))}

    <h2 id="contributing">Contributing</h2>
    
    <p>We're excited to have your contributions to awesome-vibe-coding! If you'd like to suggest a new resource, whether something you've built or something you find useful:</p>
    
    <ol>
      <li>Open an issue on GitHub</li>
      <li>Choose the appropriate resource type (e.g., Agent, Tool, Workflow)</li>
      <li>Fill in what information you can -- at minimum, all the AI agent needs is the name and website/GitHub repo link.</li>
    </ol>
  </article>
</Layout>